---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

const hackathonEntries = await getCollection("hackathons");

// Sort by start date, most recent first
const sortedHackathons = hackathonEntries.sort(
  (a, b) => b.data.startDate.getTime() - a.data.startDate.getTime()
);

function formatPeriod(startDate: Date, endDate?: Date) {
  const options: Intl.DateTimeFormatOptions = {
    month: "short",
    day: "numeric",
    year: "numeric",
  };
  const start = startDate.toLocaleDateString("en-US", options);

  if (endDate && endDate.getTime() !== startDate.getTime()) {
    const end = endDate.toLocaleDateString("en-US", options);
    return `${start} - ${end}`;
  }

  return start;
}
---

<section id="hackathons" class="py-20 px-4">
  <div class="max-w-4xl mx-auto">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold mb-4">Hackathons & Capture the Flag (CTF) Events</h2>
      <!-- 
      <p class="text-lg text-base-content/70">
        During my time in university, I attended multiple hackathons. People
        from around the country would come together and build incredible things
        in 2-3 days. It was eye-opening to see the endless possibilities brought
        to life by a group of motivated and passionate individuals.
      </p>
      -->
    </div>

    <div class="space-y-6">
      {
        sortedHackathons.map((hackathon) => (
          <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
            <div class="card-body">
              <div class="flex items-start gap-4">
                {hackathon.data.logo && (
                  <div class="flex-shrink-0 w-16 h-16 flex items-center justify-center">
                    <Image
                      src={hackathon.data.logo}
                      alt={hackathon.data.title}
                      width={64}
                      height={64}
                      class="max-w-full max-h-full object-contain"
                    />
                  </div>
                )}
                <div class="flex-1">
                  <time class="text-sm text-base-content/60">
                    {formatPeriod(
                      hackathon.data.startDate,
                      hackathon.data.endDate
                    )}
                  </time>
                  <h3 class="card-title mt-1">{hackathon.data.title}</h3>
                  <p class="text-sm text-primary font-semibold">
                    {hackathon.data.location}
                  </p>
                  <div class="text-base-content/80 mt-3 prose prose-sm max-w-none
                    [&_p]:mb-4
                    [&_ul]:mb-4 [&_ul]:ml-6 [&_ul]:list-disc [&_ul]:list-outside
                    [&_ol]:mb-4 [&_ol]:ml-6 [&_ol]:list-decimal [&_ol]:list-outside
                    [&_li]:mb-2
                    whitespace-pre-line">{hackathon.data.description}</div>
                  {hackathon.data.sourceLink && (
                    <div class="card-actions mt-4">
                      <a
                        href={hackathon.data.sourceLink}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="btn btn-sm btn-outline btn-primary"
                      >
                        Writeup
                      </a>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
